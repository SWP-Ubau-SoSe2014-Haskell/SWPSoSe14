<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>IntermediateCode</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_IntermediateCode.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">rail-compiler-editor-0.2.0.0: Compiler and editor for the esolang rail.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Maintainer</th><td>Philipp Borgers, Tilman Blumenbach, Lyudmila Vaseva, Sascha Zinke,
               Maximilian Claus, Michal Ajchman, Nicolas Lehmann, Tudor Soroceanu</td></tr><tr><th>Safe Haskell</th><td>None</td></tr></table><p class="caption">IntermediateCode</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>License     :  MIT
Stability   :  unstable
</p><p>IntemediateCode.hs takes the output from the SemanticalAnalysis module
(which is a list of paths) and generates LLVM IR code.
It turns every path of the form (PathID, [Lexeme], PathID) into a basic block.
</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="#t:CodegenState">CodegenState</a>  = <a href="#v:CodegenState">CodegenState</a> {<ul class="subs"><li><a href="#v:blocks">blocks</a> :: [BasicBlock]</li><li><a href="#v:count">count</a> :: Word</li><li><a href="#v:localDict">localDict</a> :: Map String (Int, Integer)</li></ul>}</li><li class="src short"><span class="keyword">newtype</span>  <a href="#t:Codegen">Codegen</a> a = <a href="#v:Codegen">Codegen</a> {<ul class="subs"><li><a href="#v:runCodegen">runCodegen</a> :: State <a href="IntermediateCode.html#t:CodegenState">CodegenState</a> a</li></ul>}</li><li class="src short"><span class="keyword">data</span>  <a href="#t:GlobalCodegenState">GlobalCodegenState</a>  = <a href="#v:GlobalCodegenState">GlobalCodegenState</a> {<ul class="subs"><li><a href="#v:dict">dict</a> :: Map String (Int, Integer)</li></ul>}</li><li class="src short"><span class="keyword">newtype</span>  <a href="#t:GlobalCodegen">GlobalCodegen</a> a = <a href="#v:GlobalCodegen">GlobalCodegen</a> {<ul class="subs"><li><a href="#v:runGlobalCodegen">runGlobalCodegen</a> :: State <a href="IntermediateCode.html#t:GlobalCodegenState">GlobalCodegenState</a> a</li></ul>}</li><li class="src short"><a href="#v:execGlobalCodegen">execGlobalCodegen</a> ::  Map String (Int, Integer) -&gt; <a href="IntermediateCode.html#t:GlobalCodegen">GlobalCodegen</a> a -&gt; a</li><li class="src short"><a href="#v:execCodegen">execCodegen</a> ::  Map String (Int, Integer) -&gt; <a href="IntermediateCode.html#t:Codegen">Codegen</a> a -&gt; a</li><li class="src short"><a href="#v:generateModule">generateModule</a> :: [Definition] -&gt; Module</li><li class="src short"><a href="#v:terminator">terminator</a> :: Integer -&gt; Named Terminator</li><li class="src short"><a href="#v:createGlobalString">createGlobalString</a> :: <a href="InterfaceDT.html#t:Lexeme">Lexeme</a> -&gt; Global</li><li class="src short"><a href="#v:generateConstants">generateConstants</a> :: [<a href="InterfaceDT.html#t:AST">AST</a>] -&gt; [Global]</li><li class="src short"><a href="#v:getAllCons">getAllCons</a> :: [<a href="InterfaceDT.html#t:AST">AST</a>] -&gt; [<a href="InterfaceDT.html#t:Lexeme">Lexeme</a>]</li><li class="src short"><a href="#v:createGlobalVariable">createGlobalVariable</a> :: <a href="InterfaceDT.html#t:Lexeme">Lexeme</a> -&gt; Global</li><li class="src short"><a href="#v:generateVariables">generateVariables</a> :: [<a href="InterfaceDT.html#t:AST">AST</a>] -&gt; [Global]</li><li class="src short"><a href="#v:generateInstruction">generateInstruction</a> :: (<a href="InterfaceDT.html#t:Lexeme">Lexeme</a>, String) -&gt; <a href="IntermediateCode.html#t:Codegen">Codegen</a> [Named Instruction]</li><li class="src short"><a href="#v:appendName">appendName</a> ::  [a] -&gt; String -&gt; [(a, String)]</li><li class="src short"><a href="#v:generateBasicBlock">generateBasicBlock</a> :: ((Int, [<a href="InterfaceDT.html#t:Lexeme">Lexeme</a>], Int), String) -&gt; <a href="IntermediateCode.html#t:Codegen">Codegen</a> BasicBlock</li><li class="src short"><a href="#v:generateBasicBlocks">generateBasicBlocks</a> :: [(Int, [<a href="InterfaceDT.html#t:Lexeme">Lexeme</a>], Int)] -&gt; String -&gt; <a href="IntermediateCode.html#t:Codegen">Codegen</a> [BasicBlock]</li><li class="src short"><a href="#v:generateFunction">generateFunction</a> :: <a href="InterfaceDT.html#t:AST">AST</a> -&gt; <a href="IntermediateCode.html#t:GlobalCodegen">GlobalCodegen</a> Definition</li><li class="src short"><a href="#v:fresh">fresh</a> :: <a href="IntermediateCode.html#t:Codegen">Codegen</a> Word</li><li class="src short"><a href="#v:generateFunctions">generateFunctions</a> :: [<a href="InterfaceDT.html#t:AST">AST</a>] -&gt; <a href="IntermediateCode.html#t:GlobalCodegen">GlobalCodegen</a> [Definition]</li><li class="src short"><a href="#v:generateGlobalDefinition">generateGlobalDefinition</a> :: Integer -&gt; Global -&gt; Definition</li><li class="src short"><a href="#v:generateGlobalDefinitionVar">generateGlobalDefinitionVar</a> :: Integer -&gt; Global -&gt; Definition</li><li class="src short"><a href="#v:process">process</a> :: <a href="InterfaceDT.html#t:SemAna2InterCode">SemAna2InterCode</a> -&gt; <a href="InterfaceDT.html#t:InterCode2Backend">InterCode2Backend</a></li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:CodegenState" class="def">CodegenState</a>  </p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:CodegenState" class="def">CodegenState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:blocks" class="def">blocks</a> :: [BasicBlock]</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:count" class="def">count</a> :: Word</dt><dd class="doc empty">&nbsp;</dd><dt class="src"><a name="v:localDict" class="def">localDict</a> :: Map String (Int, Integer)</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">newtype</span>  <a name="t:Codegen" class="def">Codegen</a> a </p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:Codegen" class="def">Codegen</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:runCodegen" class="def">runCodegen</a> :: State <a href="IntermediateCode.html#t:CodegenState">CodegenState</a> a</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:GlobalCodegenState" class="def">GlobalCodegenState</a>  </p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:GlobalCodegenState" class="def">GlobalCodegenState</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:dict" class="def">dict</a> :: Map String (Int, Integer)</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><span class="keyword">newtype</span>  <a name="t:GlobalCodegen" class="def">GlobalCodegen</a> a </p><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:GlobalCodegen" class="def">GlobalCodegen</a></td><td class="doc empty">&nbsp;</td></tr><tr><td colspan="2"><div class="subs fields"><p class="caption">Fields</p><dl><dt class="src"><a name="v:runGlobalCodegen" class="def">runGlobalCodegen</a> :: State <a href="IntermediateCode.html#t:GlobalCodegenState">GlobalCodegenState</a> a</dt><dd class="doc empty">&nbsp;</dd></dl><div class="clear"></div></div></td></tr></table></div></div><div class="top"><p class="src"><a name="v:execGlobalCodegen" class="def">execGlobalCodegen</a> ::  Map String (Int, Integer) -&gt; <a href="IntermediateCode.html#t:GlobalCodegen">GlobalCodegen</a> a -&gt; a</p></div><div class="top"><p class="src"><a name="v:execCodegen" class="def">execCodegen</a> ::  Map String (Int, Integer) -&gt; <a href="IntermediateCode.html#t:Codegen">Codegen</a> a -&gt; a</p></div><div class="top"><p class="src"><a name="v:generateModule" class="def">generateModule</a> :: [Definition] -&gt; Module</p><div class="doc"><p>Generate module from list of definitions.
</p></div></div><div class="top"><p class="src"><a name="v:terminator" class="def">terminator</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: Integer</td><td class="doc"><p>The 32-bit Integer to return.
</p></td></tr><tr><td class="src">-&gt; Named Terminator</td><td class="doc"><p>The return statement.
</p></td></tr></table></div><div class="doc"><p>Generate a ret statement, returning a 32-bit Integer to the caller.
 While we use 64-bit integers everywhere else, our <a href="main.html">main</a> function
 needs to return an <a href="int.html">int</a> which usually is 32-bits even on 64-bit systems.
</p></div></div><div class="top"><p class="src"><a name="v:createGlobalString" class="def">createGlobalString</a> :: <a href="InterfaceDT.html#t:Lexeme">Lexeme</a> -&gt; Global</p><div class="doc"><p>Generate global byte array (from a constant string).
</p></div></div><div class="top"><p class="src"><a name="v:generateConstants" class="def">generateConstants</a> :: [<a href="InterfaceDT.html#t:AST">AST</a>] -&gt; [Global]</p><div class="doc"><p>Create constant strings/byte arrays for a module.
 TODO: Maybe rename these subfunctions?
</p></div></div><div class="top"><p class="src"><a name="v:getAllCons" class="def">getAllCons</a> :: [<a href="InterfaceDT.html#t:AST">AST</a>] -&gt; [<a href="InterfaceDT.html#t:Lexeme">Lexeme</a>]</p><div class="doc"><p>Get all <code>Constant</code>s in a module.
</p></div></div><div class="top"><p class="src"><a name="v:createGlobalVariable" class="def">createGlobalVariable</a> :: <a href="InterfaceDT.html#t:Lexeme">Lexeme</a> -&gt; Global</p><div class="doc"><p>Generate global variables for push and pop from and into variables.
</p></div></div><div class="top"><p class="src"><a name="v:generateVariables" class="def">generateVariables</a> :: [<a href="InterfaceDT.html#t:AST">AST</a>] -&gt; [Global]</p><div class="doc"><p>Generate all global variable definitions for a module.
</p></div></div><div class="top"><p class="src"><a name="v:generateInstruction" class="def">generateInstruction</a> :: (<a href="InterfaceDT.html#t:Lexeme">Lexeme</a>, String) -&gt; <a href="IntermediateCode.html#t:Codegen">Codegen</a> [Named Instruction]</p><div class="doc"><p>Generate an instruction for the <code>u</code>nderflow check command.
</p></div></div><div class="top"><p class="src"><a name="v:appendName" class="def">appendName</a> ::  [a] -&gt; String -&gt; [(a, String)]</p><div class="doc"><p>Appends the function name to the lexemes/instructions.
</p><p>The function name is only relevant for the Lambda instruction, because we use
 <a href="functionName.html">functionName</a>!<a href="jumpLable.html">jumpLable</a> as name for the Lambda functions.
</p></div></div><div class="top"><p class="src"><a name="v:generateBasicBlock" class="def">generateBasicBlock</a> :: ((Int, [<a href="InterfaceDT.html#t:Lexeme">Lexeme</a>], Int), String) -&gt; <a href="IntermediateCode.html#t:Codegen">Codegen</a> BasicBlock</p><div class="doc"><p>Generate the instructions making up one basic block.
</p></div></div><div class="top"><p class="src"><a name="v:generateBasicBlocks" class="def">generateBasicBlocks</a> :: [(Int, [<a href="InterfaceDT.html#t:Lexeme">Lexeme</a>], Int)] -&gt; String -&gt; <a href="IntermediateCode.html#t:Codegen">Codegen</a> [BasicBlock]</p><div class="doc"><p>Generate all basic blocks for a function.
</p></div></div><div class="top"><p class="src"><a name="v:generateFunction" class="def">generateFunction</a> :: <a href="InterfaceDT.html#t:AST">AST</a> -&gt; <a href="IntermediateCode.html#t:GlobalCodegen">GlobalCodegen</a> Definition</p><div class="doc"><p>Generate a function definition from an AST.
</p><p>At the beginning of each function, we create a block with lable <a href="entry.html">entry</a>.
 In this block we create the symbol table and jump then to <a href="l_1.html">l_1</a>, the first 
 regular block in each function.
 The first pattern-matching is for lambda functions
</p></div></div><div class="top"><p class="src"><a name="v:fresh" class="def">fresh</a> :: <a href="IntermediateCode.html#t:Codegen">Codegen</a> Word</p><div class="doc"><p>Create a new local variable (?).
</p></div></div><div class="top"><p class="src"><a name="v:generateFunctions" class="def">generateFunctions</a> :: [<a href="InterfaceDT.html#t:AST">AST</a>] -&gt; <a href="IntermediateCode.html#t:GlobalCodegen">GlobalCodegen</a> [Definition]</p><div class="doc"><p>Generate list of LLVM Definitions from list of ASTs
</p></div></div><div class="top"><p class="src"><a name="v:generateGlobalDefinition" class="def">generateGlobalDefinition</a> :: Integer -&gt; Global -&gt; Definition</p><div class="doc"><p>Generate a global definition for a constant.
</p><p>This is an unnamed, global constant, i. e. it has a numeric name
 like '@0'.
</p></div></div><div class="top"><p class="src"><a name="v:generateGlobalDefinitionVar" class="def">generateGlobalDefinitionVar</a> :: Integer -&gt; Global -&gt; Definition</p><div class="doc"><p>Generate a global definition for a variable name.
</p><p>Such definitions are used to pass variable names to
 LLVM backend functions like 'pop_into()'.
</p></div></div><div class="top"><p class="src"><a name="v:process" class="def">process</a> :: <a href="InterfaceDT.html#t:SemAna2InterCode">SemAna2InterCode</a> -&gt; <a href="InterfaceDT.html#t:InterCode2Backend">InterCode2Backend</a></p><div class="doc"><p>Entry point into module.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.13.2</p></div></body></html>